<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://uposs.justokay.cn/images/favicon.ico"><link rel="icon" href="https://uposs.justokay.cn/images/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="dyhu"><meta name="keywords" content=""><meta name="description" content="Spring-Data-JPA provides many common Repository interfaces, such as CrudRepository, PagingAndSortingRepository, JpaRepository and so on. In practical development we often have some custom methods, so"><meta property="og:type" content="article"><meta property="og:title" content="Spring Data JPA Custom Repository Example"><meta property="og:url" content="https://okayhu.github.io/blog/posts/2022/spring-jpa-custom-repository/index.html"><meta property="og:site_name" content="dyhu&#39;s blog"><meta property="og:description" content="Spring-Data-JPA provides many common Repository interfaces, such as CrudRepository, PagingAndSortingRepository, JpaRepository and so on. In practical development we often have some custom methods, so"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://uposs.justokay.cn/images/spring/spring-date-jpa.png"><meta property="article:published_time" content="2022-08-26T14:16:41.000Z"><meta property="article:modified_time" content="2023-01-10T14:43:41.586Z"><meta property="article:author" content="dyhu"><meta property="article:tag" content="spring"><meta property="article:tag" content="jpa"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://uposs.justokay.cn/images/spring/spring-date-jpa.png"><title>Spring Data JPA Custom Repository Example - dyhu&#39;s blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/blog/css/main.css"><link id="highlight-css" rel="stylesheet" href="/blog/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/blog/css/highlight-dark.css"><link rel="stylesheet" href="/blog/css/custom.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"okayhu.github.io",root:"/blog/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"https://uposs.justokay.cn/images/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:"G-NZR9Y6CNBN",gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/blog/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/blog/js/utils.js"></script><script src="/blog/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="dyhu's blog" type="application/atom+xml">
</head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/blog/"><strong>dyhu&#39;s blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/blog/"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/archives/"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/categories/"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/tags/"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/about/"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" false style="background:url(https://uposs.justokay.cn/images/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Spring Data JPA Custom Repository Example"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-08-26 22:16" pubdate>2022-08-26</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.3k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 28 mins</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Spring Data JPA Custom Repository Example</h1><div class="markdown-body"><p>Spring-Data-JPA provides many common Repository interfaces, such as CrudRepository, PagingAndSortingRepository, JpaRepository and so on. In practical development we often have some custom methods, so how should we extend the Repository interface?</p><h2 id="Base-class"><a href="#Base-class" class="headerlink" title="Base class"></a>Base class</h2><p>First define a BaseRepository that inherits from JpaRepository and write the methods we want to extend</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@NoRepositoryBean</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BaseRepository</span>&lt;T, ID&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JpaRepository</span>&lt;T, ID&gt; &#123;

    List&lt;T&gt; <span class="hljs-title function_">findByIdIn</span><span class="hljs-params">(Iterable&lt;ID&gt; ids)</span>;

    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByIdIn</span><span class="hljs-params">(Iterable&lt;ID&gt; ids)</span>;
&#125;</code></pre></div><p>The <code>@NoRepositoryBean</code> is used to inform the Spring container not to instantiate the BaseRepository, since the BaseRepository is used as an intermediate interface to derive the concrete Repository interface.</p><p>Next, create an implementation class of the BaseRepository that implements the extended methods</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseRepositoryImpl</span>&lt;T, ID&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleJpaRepository</span>&lt;T, ID&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BaseRepository</span>&lt;T, ID&gt; &#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EntityManager em;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JpaEntityInformation&lt;T, ?&gt; entityInformation;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BaseRepositoryImpl</span><span class="hljs-params">(JpaEntityInformation&lt;T, ?&gt; entityInformation, EntityManager entityManager)</span> &#123;
        <span class="hljs-built_in">super</span>(entityInformation, entityManager);
        <span class="hljs-built_in">this</span>.em = entityManager;
        <span class="hljs-built_in">this</span>.entityInformation = entityInformation;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;T&gt; <span class="hljs-title function_">findByIdIn</span><span class="hljs-params">(Iterable&lt;ID&gt; ids)</span> &#123;
        <span class="hljs-keyword">return</span> findAllById(ids);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteById</span><span class="hljs-params">(ID id)</span> &#123;
        Assert.notNull(id, <span class="hljs-string">&quot;Id must not be null!&quot;</span>);

        <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> em.getCriteriaBuilder();
        CriteriaDelete&lt;T&gt; delete = builder.createCriteriaDelete(getDomainClass());
        Root&lt;T&gt; root = delete.from(getDomainClass());
        delete.where(builder.equal(root.get(entityInformation.getIdAttribute()), id));
        em.createQuery(delete).executeUpdate();
    &#125;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByIdIn</span><span class="hljs-params">(Iterable&lt;ID&gt; ids)</span> &#123;
        Assert.notNull(ids, <span class="hljs-string">&quot;Ids must not be null!&quot;</span>);

        <span class="hljs-keyword">if</span> (ids.iterator().hasNext()) &#123;
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> em.getCriteriaBuilder();
            CriteriaDelete&lt;T&gt; delete = builder.createCriteriaDelete(getDomainClass());
            Root&lt;T&gt; root = delete.from(getDomainClass());
            delete.where(getIdsPredicate(builder, root, ids));
            em.createQuery(delete).executeUpdate();
        &#125;
    &#125;

    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span>
    <span class="hljs-keyword">protected</span> Predicate <span class="hljs-title function_">getIdsPredicate</span><span class="hljs-params">(CriteriaBuilder builder, Root&lt;T&gt; root, Iterable&lt;ID&gt; ids)</span> &#123;
        Path&lt;ID&gt; path = (Path&lt;ID&gt;) root.get(entityInformation.getIdAttribute());
        CriteriaBuilder.In&lt;ID&gt; inPredicate = builder.in(path);
        ids.forEach(inPredicate::value);
        <span class="hljs-keyword">return</span> inPredicate;
    &#125;
&#125;</code></pre></div><h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>Finally we can specify the new repositoryBaseClass on the main class with <code>@EnableJpaRepositories</code></p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@EnableJpaRepositories(repositoryBaseClass = BaseRepositoryImpl.class)</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JpaExamplesApplication</span> &#123;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;
        SpringApplication.run(JpaExamplesApplication.class, args);
    &#125;
&#125;</code></pre></div><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Instead of inheriting from JpaRepository, our Repository interface inherits from BaseRepository</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span>&lt;User, Long&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseRepository</span>&lt;User, Long&gt; &#123;
&#125;</code></pre></div><p>Next, we test our custom method</p><div class="code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseRepositoryTests</span> &#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository userRepository;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteByIdIn_test</span><span class="hljs-params">()</span> &#123;
		userRepository.deleteByIdIn(Arrays.asList(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>));
    &#125;
&#125;</code></pre></div><p>Turn on SQL printing:</p><div class="code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">spring.jpa.show-sql</span>=<span class="hljs-string">true</span></code></pre></div><p>Console output successfully: <code>Hibernate: delete from user where id in (1 , 2)</code></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/blog/categories/Spring/" class="category-chain-item">Spring</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/blog/tags/spring/">#spring</a> <a href="/blog/tags/jpa/">#jpa</a></div></div><div class="license-box my-3"><div class="license-title"><div>Spring Data JPA Custom Repository Example</div><div>https://okayhu.github.io/blog/posts/2022/spring-jpa-custom-repository/</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>dyhu</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>August 26, 2022</div></div><div class="license-meta-item"><div>Licensed under</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - Share-alike"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/blog/posts/2022/idea-database-groovy/" title="How To Generate Database Entities With Groovy Scripts Sn IntelliJ IDEA"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">How To Generate Database Entities With Groovy Scripts Sn IntelliJ IDEA</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/blog/posts/2022/jvm-object-gc/" title="Object References And GC Algorithms In Java"><span class="hidden-mobile">Object References And GC Algorithms In Java</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div class="disqus" style="width:100%"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config=function(){this.page.url="https://okayhu.github.io/blog/posts/2022/spring-jpa-custom-repository/",this.page.identifier="/blog/posts/2022/spring-jpa-custom-repository/"};Fluid.utils.loadComments("#disqus_thread",(function(){var t=document,s=t.createElement("script");s.src="//dyhu-blog.disqus.com/embed.js",s.setAttribute("data-timestamp",new Date),(t.head||t.body).appendChild(s)}))</script><noscript>Please enable JavaScript to view the comments</noscript></div></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content">Copyright © 2022 dyhu - <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a><i class="iconfont icon-love"></i><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/blog/js/events.js"></script><script src="/blog/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/blog/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/blog/js/local-search.js"></script><script src="/blog/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript></body></html>