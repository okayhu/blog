<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"okayhu.github.io","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.14.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script>

    <meta name="description" content="Object creation process Checking loadingFirst check that the parameters of this instruction locate a symbolic reference to a class in the constant pool (symbolic reference: a symbolic reference descri">
<meta property="og:type" content="article">
<meta property="og:title" content="Object Creation Process And Memory Layout In Java">
<meta property="og:url" content="https://okayhu.github.io/blog/posts/2022/jvm-object-memory/index.html">
<meta property="og:site_name" content="dyhu&#39;s blog">
<meta property="og:description" content="Object creation process Checking loadingFirst check that the parameters of this instruction locate a symbolic reference to a class in the constant pool (symbolic reference: a symbolic reference descri">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://uposs.justokay.cn/images/jvm/jvm-object-memory-01.png">
<meta property="og:image" content="https://uposs.justokay.cn/images/jvm/jvm-object-memory-02.png">
<meta property="og:image" content="https://uposs.justokay.cn/images/jvm/jvm-object-memory-03.png">
<meta property="og:image" content="https://uposs.justokay.cn/images/jvm/jvm-object-memory-04.png">
<meta property="article:published_time" content="2022-07-04T07:34:20.000Z">
<meta property="article:modified_time" content="2023-01-12T08:05:22.583Z">
<meta property="article:author" content="dyhu">
<meta property="article:tag" content="jvm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://uposs.justokay.cn/images/jvm/jvm-object-memory-01.png">


<link rel="canonical" href="https://okayhu.github.io/blog/posts/2022/jvm-object-memory/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://okayhu.github.io/blog/posts/2022/jvm-object-memory/","path":"posts/2022/jvm-object-memory/","title":"Object Creation Process And Memory Layout In Java"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Object Creation Process And Memory Layout In Java | dyhu's blog</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/blog/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start --><script async src="https://www.googletagmanager.com/gtag/js?id=G-FFSPHD4588"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FFSPHD4588');
    </script><!-- hexo injector head_end end --><link rel="alternate" href="/blog/atom.xml" title="dyhu's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">dyhu's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-about"><a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-sitemap"><a href="/blog/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Object-creation-process"><span class="nav-number">1.</span> <span class="nav-text">Object creation process</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Checking-loading"><span class="nav-number">1.1.</span> <span class="nav-text">Checking loading</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Allocating-memory"><span class="nav-number">1.2.</span> <span class="nav-text">Allocating memory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-space-initialization"><span class="nav-number">1.3.</span> <span class="nav-text">Memory space initialization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Setup"><span class="nav-number">1.4.</span> <span class="nav-text">Setup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Object-initialization"><span class="nav-number">1.5.</span> <span class="nav-text">Object initialization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Object-memory-allocation-strategy"><span class="nav-number">2.</span> <span class="nav-text">Object memory allocation strategy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-layout-of-objects"><span class="nav-number">3.</span> <span class="nav-text">Memory layout of objects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Object-Header"><span class="nav-number">3.1.</span> <span class="nav-text">Object Header</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Instance-Data"><span class="nav-number">3.2.</span> <span class="nav-text">Instance Data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alignment-Padding"><span class="nav-number">3.3.</span> <span class="nav-text">Alignment Padding</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Object-Access-Location"><span class="nav-number">4.</span> <span class="nav-text">Object Access Location</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Direct-pointers"><span class="nav-number">4.1.</span> <span class="nav-text">Direct pointers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Handles"><span class="nav-number">4.2.</span> <span class="nav-text">Handles</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dyhu"
      src="https://uposs.justokay.cn/images/avatar.png">
  <p class="site-author-name" itemprop="name">dyhu</p>
  <div class="site-description" itemprop="description">Keep yourself and be kind to others</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/okayhu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;okayhu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:okayhu66@gmail.com" title="Email → mailto:okayhu66@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>Email</a>
      </span>
  </div>
<div class="cc-license animated" itemprop="license">
  <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener external nofollow noreferrer" target="_blank" class="exturl cc-opacity" title=""><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></a>
</div>
        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://okayhu.github.io/blog/posts/2022/jvm-object-memory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://uposs.justokay.cn/images/avatar.png">
      <meta itemprop="name" content="dyhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dyhu's blog">
      <meta itemprop="description" content="Keep yourself and be kind to others">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Object Creation Process And Memory Layout In Java | dyhu's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Object Creation Process And Memory Layout In Java
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-04 15:34:20" itemprop="dateCreated datePublished" datetime="2022-07-04T15:34:20+08:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-12 16:05:22" itemprop="dateModified" datetime="2023-01-12T16:05:22+08:00">2023-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/posts/2022/jvm-object-memory/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/2022/jvm-object-memory/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>6 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="Object-creation-process"><a href="#Object-creation-process" class="headerlink" title="Object creation process"></a>Object creation process</h2><p><img src="https://uposs.justokay.cn/images/jvm/jvm-object-memory-01.png" alt="jvm-object-memory-01"></p>
<h3 id="Checking-loading"><a href="#Checking-loading" class="headerlink" title="Checking loading"></a>Checking loading</h3><p>First check that the parameters of this instruction locate a symbolic reference to a class in the constant pool (symbolic reference: a symbolic reference describes the referenced target by a set of symbols) and that the class has been loaded, parsed and initialized.</p>
<h3 id="Allocating-memory"><a href="#Allocating-memory" class="headerlink" title="Allocating memory"></a>Allocating memory</h3><p>The virtual machine will allocate memory for the new object. The task of allocating space for an object is equivalent to partitioning a definite size chunk of memory from the Java heap.</p>
<p>Allocating memory is done in two ways.</p>
<ul>
<li><strong>Pointer collision</strong>: If the memory in the Java heap is absolutely regular, with all used memory on one side and free memory on the other, with a pointer placed in the middle as an indicator of the division point. Then the allocated memory is simply moving that pointer towards the free space by a distance equal to the size of the object, and this allocation is called pointer collision.</li>
<li><strong>Free List</strong>: If the memory in the Java heap is not regular, and used memory and free memory are interleaved, then there is no way to simply perform pointer collisions, and the virtual machine must maintain a list of which memory blocks are available. When allocating a block from the list that is large enough to be divided among object instances, and updating the record on the list, this allocation is called a free list.</li>
</ul>
<div class="note info"><p>The choice of allocation method is determined by whether the Java heap is tidy, which in turn is determined by whether the garbage collector used has compression and tidying. If you use a garbage collector with compressed collation like Serial or ParNew, the system uses pointer collision, which is simple and efficient. If you use a garbage collector like CMS without compressed collation, theoretically you can only use a more complex idle list.</p>
</div>

<p>The JVM also has to consider concurrency safety when allocating memory, and there are two solutions to this problem:</p>
<ul>
<li><code>CAS</code>: The action of allocating memory space is handled synchronously, in fact the VM uses CAS with failure retries to ensure atomicity of update operations.</li>
<li><code>TLAB (Thread Local Allocation Buffer)</code>.</li>
<li>Overview: The memory allocation action is divided into different spaces according to threads, i.e., each thread is pre-allocated a small piece of private memory in the Java heap, i.e., the Local Thread Allocation Buffer (TLAB).<ul>
<li>Step: When the JVM initializes a thread, it also requests a piece of memory of a specified size for the current thread only, so that each thread has a separate Buffer, and if it needs to allocate memory, it will allocate it on its own Buffer. area when the Buffer is running low.</li>
<li>Parameters: <code>JVM options: -XX:+UseTLAB</code> Allows the use of thread local allocation blocks (TLAB) in the young generation space, enabled by default.</li>
</ul>
</li>
</ul>
<h3 id="Memory-space-initialization"><a href="#Memory-space-initialization" class="headerlink" title="Memory space initialization"></a>Memory space initialization</h3><p>Note that the virtual machine needs to initialize the allocated memory space to zero values (e.g., 0 for int, false for boolean, etc.) after the memory allocation is completed, not the constructor. This step ensures that the object’s instance fields can be used directly in Java code without being assigned initial values, and that the program can access the zero values corresponding to the data types of these fields.</p>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>Next, the virtual machine makes the necessary settings for the object, such as which class the object is an instance of, how to find the class metadata information (Java Classes are represented as class metadata inside the Java hotspot VM), the object’s hash code, the object’s GC generation age, and other information. This information is stored in the object header of the object.</p>
<h3 id="Object-initialization"><a href="#Object-initialization" class="headerlink" title="Object initialization"></a>Object initialization</h3><p>After all the above work is done, a new object has been created from the VM’s point of view, but from the Java program’s point of view, the object creation has just started and all the fields are still zero-valued. So, in general, the execution of the new instruction is followed by the initialization of the object according to the programmer’s wishes (execution of the <code>init</code> method), so that a truly usable object is fully created.</p>
<h2 id="Object-memory-allocation-strategy"><a href="#Object-memory-allocation-strategy" class="headerlink" title="Object memory allocation strategy"></a>Object memory allocation strategy</h2><p>Memory allocation for objects is usually done on the Java heap, but with the advent of virtual machine optimization techniques (<code>escaping analysis techniques</code>), in some scenarios it is also done on the stack. Objects are mainly allocated in the Eden area of the new generation, and if a local thread buffer is started, they will be allocated on TLAB according to thread priority. In a few cases, they are also allocated directly on the old generation.</p>
<p>In general the allocation rules are not 100% fixed, the details depend on which combination of garbage collectors and VM related parameters are involved, but the VM will follow the following general rules for memory allocation.</p>
<ul>
<li><strong>Objects are allocated in the Eden area first</strong>, and if there is not enough space in the Eden area, the VM performs a Minor GC.</li>
<li><strong>Large objects go directly to the old age (large objects are those that require a lot of contiguous memory space)</strong>. This is done to avoid a large number of memory copies occurring between the Eden zone and the two Survivor zones (the new generation uses a replication algorithm to collect memory).</li>
<li><strong>Long-term surviving objects go to the old generation</strong>. The virtual machine defines an age counter for each object, if the object has survived 1 Minor GC, the object enters the Survivor zone and sets the object age to 1. The age of the object increases by 1 for each Minor GC it survives in the Survivor zone, and when it increases to a certain age (<strong>the concurrent garbage collector defaults to 15, the CMS is 6</strong>), it will be promoted to the old age. This can be adjusted with <code>-XX:MaxTenuringThreshold</code>.</li>
<li><strong>Dynamically determine the age of an object</strong>. In order to better adapt to the memory situation of different programs, the VM does not always require the age of an object to reach <code>MaxTenuringThreshold</code> before it can be promoted to an older age. If the sum of all objects of the same age in Survivor space is greater than half the size of Survivor space, objects with an age greater than or equal to that age can be directly aged, without waiting for the age required in <code>MaxTenuringThreshold</code>.</li>
<li><strong>Space Allocation Guarantee</strong>. Before each Minor GC, the VM checks if the maximum available contiguous space in the old age is greater than the total space of all objects in the new age. If this condition is not true, the VM will check if the <code>HandlePromotionFailure</code> setting allows the guarantee to fail. If <code>HandlePromotionFailure=true</code>, then it will continue to check if the maximum available contiguous space in the old age is greater than the average size of objects promoted to the old age over time, and if it is, then a Minor GC will be attempted, but this Minor GC is still risky; if it is less than or <code>HandlePromotionFailure=false</code>, then a Full GC is performed instead.</li>
</ul>
<h2 id="Memory-layout-of-objects"><a href="#Memory-layout-of-objects" class="headerlink" title="Memory layout of objects"></a>Memory layout of objects</h2><p><img src="https://uposs.justokay.cn/images/jvm/jvm-object-memory-02.png" alt="jvm-object-memory-02"></p>
<p>In the HotSpot VM, the layout of objects stored in memory can be divided into 3 areas: Object Header, Instance Data, and Alignment Padding.</p>
<h3 id="Object-Header"><a href="#Object-Header" class="headerlink" title="Object Header"></a>Object Header</h3><p>The object header is divided into two parts in the HotSpot virtual machine, one called the Mark Word and the other a type pointer. If the object is an array, there is a piece of data in the object header that is used to record the length of the array.</p>
<table>
<thead>
<tr>
<th align="center">length</th>
<th align="center">content</th>
<th align="center">description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">32&#x2F;64bit</td>
<td align="center">Mark Word</td>
<td align="center">stores the hashcode, bias lock pattern, lock information and GC age of the object.</td>
</tr>
<tr>
<td align="center">32&#x2F;64bit</td>
<td align="center">Class Metadata Address</td>
<td align="center">A pointer to the object’s class metadata.</td>
</tr>
<tr>
<td align="center">32&#x2F;64bit</td>
<td align="center">Array Length</td>
<td align="center">The length of the array (not necessarily available)</td>
</tr>
</tbody></table>
<h3 id="Instance-Data"><a href="#Instance-Data" class="headerlink" title="Instance Data"></a>Instance Data</h3><p>Instance data is the actual valid information stored in the object, and is also the information about the properties of the object as defined in the program code.</p>
<h3 id="Alignment-Padding"><a href="#Alignment-Padding" class="headerlink" title="Alignment Padding"></a>Alignment Padding</h3><p>Padding is not necessarily present and has no special meaning; it acts as a placeholder. Since the HotSpot VM’s automatic memory management system requires that the size of an object be an integer multiple of <strong>8 bytes</strong>, alignment padding is needed to fill in other parts of the object’s data when they are not aligned.</p>
<h2 id="Object-Access-Location"><a href="#Object-Access-Location" class="headerlink" title="Object Access Location"></a>Object Access Location</h2><p>Java programs need to access specific objects in the heap via references on the JVM stack. The way objects are accessed depends on the implementation of the JVM virtual machine. Currently the two dominant access methods are handles and direct pointers.</p>
<h3 id="Direct-pointers"><a href="#Direct-pointers" class="headerlink" title="Direct pointers"></a>Direct pointers</h3><p>points to an object and represents the starting address of an object in memory. If direct pointer access is used, what is stored in the reference is directly the object address, and then the layout inside the Java heap object must take into account how to place information about accessing the type data.</p>
<p><img src="https://uposs.justokay.cn/images/jvm/jvm-object-memory-03.png" alt="jvm-object-memory-03"></p>
<p>Advantages: fast, saves time overhead of one pointer location. Since object access is very frequent in Java, this type of overhead can add up to a significant implementation cost. this is the approach used in HotSpot.</p>
<h3 id="Handles"><a href="#Handles" class="headerlink" title="Handles"></a>Handles</h3><p>A handle can be understood as a pointer to a pointer that maintains a pointer to an object. The handle does not point directly to the object, but to the object’s pointer (the handle does not change and points to a fixed memory address), which in turn points to the object’s real memory address. If you use direct handle access, a chunk of memory is divided in the Java heap to serve as a pool of handles, and the reference stores the object’s handle address, which contains information about the specific address of each of the object’s instance data and object type data.</p>
<p><img src="https://uposs.justokay.cn/images/jvm/jvm-object-memory-04.png" alt="jvm-object-memory-04"></p>
<p>Advantage: the reference stores a stable handle address, and when the object is moved (it is very common to move objects during garbage collection), only the instance data pointer in the handle is changed, and the reference itself does not need to be modified.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/jvm/" rel="tag"><i class="fa fa-tag"></i> jvm</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog/posts/2022/mapstrcut-style/" rel="prev" title="Useful Tips For MapStruct">
                  <i class="fa fa-chevron-left"></i> Useful Tips For MapStruct
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog/posts/2022/docker-firewalld/" rel="next" title="Securing Docker with Firewalld">
                  Securing Docker with Firewalld <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2022 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dyhu</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">7k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">24 mins.</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/okayhu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script><script src="/blog/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/blog/js/third-party/search/local-search.js"></script>





  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"dyhu-blog","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/blog/js/third-party/comments/disqus.js"></script>

</body>
</html>
